<% content_for :switcher do %>
  <%= render '/layouts/prison_switcher' %>
<% end %>

<% if @pom.blank? %>
  <h2 class="govuk-heading-l">No allocated cases </h2>
<% else %>
  <h2 class="govuk-heading-l">Your caseload (<%= @total_allocations  %>)</h2>

  <div class="govuk-grid-row">
    <div class="govuk-grid-column-one-quarter">
      <div class="govuk-body">New cases</div>
      <div class="govuk-body govuk-!-font-weight-bold"><%= link_to "#{@new_cases_count}", new_caseload_path, class:"govuk-link"%></a></div>
    </div>
    <div class="govuk-grid-column-one-quarter">
      <div class="govuk-body">Working pattern</div>
      <div class="govuk-body govuk-!-font-weight-bold"><%= working_pattern_name(@pom.working_pattern) %></div>
    </div>
    <div class="govuk-grid-column-one-quarter">
      <div class="govuk-body">Status</div>
      <div class="govuk-body govuk-!-font-weight-bold"><%= @pom.status.capitalize %></div>
    </div>
  </div>

  <table class="govuk-table responsive tablesorter">
    <thead class="govuk-table__head">
    <tr class="govuk-table__row">
      <th class="govuk-table__header" scope="col">Prisoner name</th>
      <th class="govuk-table__header" scope="col">Prisoner number</th>
      <th class="govuk-table__header" scope="col">Earliest release<br/> date</th>
      <th class="govuk-table__header" scope="col">Allocation<br/>date</th>
      <th class="govuk-table__header" scope="col">Role</th>
      <% if Flipflop.prisoner_profile? %>
        <th class="govuk-table__header" scope="col">Action</th>
      <% end %>
    </tr>
    </thead>
    <tbody class="govuk-table__body">
    <% @allocations.each do |allocation, sentence| %>
      <tr class="govuk-table__row">
        <td aria-label="Prisoner name" class="govuk-table__cell "><%= sentence.full_name %></td>
        <td aria-label="Prisoner number" class="govuk-table__cell "><%= allocation.nomis_offender_id %></td>
        <td aria-label="Release date" class="govuk-table__cell "><%= format_date(sentence.earliest_release_date) %></td>
        <td aria-label="Allocation date" class="govuk-table__cell "><%= format_date(allocation.created_at) %></td>
        <td aria-label="Role" class="govuk-table__cell "><%= allocation.responsibility %></td>
        <% if Flipflop.prisoner_profile? %>
          <td aria-label="Action" class="govuk-table__cell ">
            <%= link_to('View', prisoner_show_path(allocation.nomis_offender_id), class: "govuk-link" ) %>
          </td>
        <% end %>
      </tr>
    <% end %>
    </tbody>
  </table>

  <%= render(
            :partial => 'shared/pagination',
            :locals => {
                :page_data => @page_meta,
                :param_name => 'page',
            }) %>
<% end %>
